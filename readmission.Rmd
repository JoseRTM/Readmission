---
title: "MODELING SUD TREATMENT READMISSION WITH A RECURRENT TIME-TO-EVENT APPROACH"
author: "José A. Ruiz-Tagle, MSc"
date: '2022-03-25'
output: beamer_presentation
theme: "CambridgeUS"
colortheme: "dolphin"
fonttheme: "structurebold"
---
```{r, eval=FALSE, results='hide'}
#token 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
```

```{r librerias, include=FALSE}
ifelse(!require("survival"), install.packages("survival"),library("survival"))
ifelse(!require("stargazer"), install.packages("stargazer"),library("stargazer"))
ifelse(!require("kableExtra"), install.packages("kableExtra"),library("kableExtra"))
ifelse(!require("ggplot2"), install.packages("ggplot2"),library("ggplot2"))
ifelse(!require("dplyr"), install.packages("dplyr"),library("dplyr"))
ifelse(!require("haven"), install.packages("haven"),library("haven"))
ifelse(!require("usethis"), install.packages("usethis"),library("usethis"))

```

```{r modelos, include=FALSE}
load("modelos.RData")
```
## Antecedentes

* El consumo indebido de sustancias se relaciona con múltiples problemas de salud:
  + Enfermedades cardiacas
  + Síntomas de psicosis
  + Conductas sexuales de riesgo
  

* Los programas de rehabilitación son el principal mecanismo para abordar este problema
  + Más del 60% del presupuesto de SENDA está destinado al tratamiento
  
## ¿Qué se sabe de los programas de rehabilitación?
* Se relaciona con diversos beneficios
  + Reducir mortalidad asociada al consumo
  + Reducir comorbilidades psiquiátricas
  + Mejorar calidad de vida
  
* En 2018, solo el 23% alcanzó el alta terapéutica

## Readmisión

* Condición de recaídas crónicas
* Sobreuso del sistema sanitario
  + Listas de espera
* Mantención del logro terapéutico al largo plazo
* Es un evento recurrente

## Eventos recurrentes

* Eventos reversibles/irreversibles
* Reversibles -> Multiples (hospitalización) o Recurrentes (readmisión)
* Dos características principales:
  + Correlación intra-individuo
  + Covariables time-variant
* ¿De dónde viene la correlación?
  + Dependencia
  + Heterogeneidad
  
## ¿Por qué necesitamos teorizar sobre esto?

* Los modelos clásicos de supervivencia se centran en el primer evento (COXPH)
* Los errores estándar pueden estar mal estimados si no consideramos la correlación
* Modelos de varianza corregida
  + Andersen Gil (AG)
  + **Prentice, Williams y Petersen (PWP)**
  + Frailty
  + WLW

## Materiales y método
* SISTRAT 
* Random forest imputation (~8% de perdidos)
* Modelos PWP
  + Total Time (TT)
  + Gap Time (GT)
* Interacción con estrato (N° de admisión)
  + <= 3 Admisiones
* Bootstrap paramétrico para obtener IC de la combinación no lineal con transformación ($\exp$)

## Resultados


```{r, message = FALSE, results = 'asis',include=FALSE}
stargazer(pwp_tt_int_miss, pwp_tt_int_rf, pwp_gt_int_miss, pwp_gt_int_rf,
          title = "Estimated PWP-TT and PWP-GT models",
          column.labels = c("PWP-TT Raw", "PWP-TT imp","PWP-GT Raw","PWP-GT imp"),
          dep.var.caption = " ",
          colnames = FALSE,
          dep.var.labels = c(" "," "),
          covariate.labels = c("Therapeutic Discharge",
                               "Female",
                               "Age of onset",
                               "Separated",
                               "Single",
                               "Widower",
                               "Cocaine","Marijuana",
                               "Other subs",
                               "Cocaine Paste",
                               "Secondary ed",
                               "Primary ed",
                               "Moderate compromise",
                               "Severe compromise",
                               "Woman specific",
                               "Employee",
                               "Inactive",
                               "Freq",
                               "Age",
                               "TD x Strata2",
                               "TD x Strata3"),
          model.numbers = FALSE,
          single.row = T,
          apply.coef = exp,
          ci = TRUE,
          digits = 2,
          omit.table.layout = "ns",
          star.char = "",
          font.size = "tiny")
```

\begin{table}[!htbp] \centering 
  \caption{Estimated PWP-TT and PWP-GT models} 
  \label{} 
\tiny 
\begin{tabular}{@{\extracolsep{5pt}}lcccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{4}{c}{ } \\ 
\cline{2-5} 
\\[-1.8ex] & \multicolumn{2}{c}{ } & \multicolumn{2}{c}{ } \\ 
 & PWP-TT Raw & PWP-TT imp & PWP-GT Raw & PWP-GT imp \\ 
\hline \\[-1.8ex] 
 Therapeutic Discharge & 0.80$^{}$ (0.77, 0.84) & \textbf{0.79$^{}$ (0.75, 0.82)} & 0.81$^{}$ (0.77, 0.85) & \textbf{0.79$^{}$ (0.76, 0.83)} \\ 
  Female & 1.22$^{}$ (1.18, 1.26) & 1.21$^{}$ (1.18, 1.25) & 1.21$^{}$ (1.17, 1.25) & 1.21$^{}$ (1.17, 1.24) \\ 
  Age of onset & 0.99$^{}$ (0.99, 1.00) & 0.99$^{}$ (0.99, 0.99) & 1.00$^{}$ (0.99, 1.00) & 0.99$^{}$ (0.99, 0.99) \\ 
  Separated & 1.02$^{}$ (0.97, 1.07) & 1.01$^{}$ (0.96, 1.05) & 1.02$^{}$ (0.97, 1.06) & 1.00$^{}$ (0.96, 1.05) \\ 
  Single & 0.95$^{}$ (0.92, 0.98) & 0.97$^{}$ (0.94, 1.00) & 0.94$^{}$ (0.91, 0.98) & 0.96$^{}$ (0.93, 0.99) \\ 
  Widower & 0.89$^{}$ (0.75, 1.04) & 0.90$^{}$ (0.77, 1.04) & 0.90$^{}$ (0.76, 1.04) & 0.91$^{}$ (0.77, 1.04) \\ 
  Cocaine & 1.21$^{}$ (1.17, 1.25) & \textbf{1.19$^{}$ (1.14, 1.23)} & 1.20$^{}$ (1.16, 1.24) & \textbf{1.18$^{}$ (1.14, 1.22)} \\ 
  Marijuana & 0.92$^{}$ (0.86, 0.99) & 0.86$^{}$ (0.79, 0.93) & 0.94$^{}$ (0.87, 1.01) & 0.88$^{}$ (0.82, 0.95) \\ 
  Other subs & 1.03$^{}$ (0.92, 1.14) & 0.96$^{}$ (0.85, 1.07) & 1.06$^{}$ (0.95, 1.17) & 0.99$^{}$ (0.88, 1.09) \\ 
  Cocaine Paste & 1.41$^{}$ (1.38, 1.45) & \textbf{1.38$^{}$ (1.34, 1.41)} & 1.42$^{}$ (1.39, 1.46) & \textbf{1.39$^{}$ (1.35, 1.42)} \\ 
  Secondary ed & 0.91$^{}$ (0.87, 0.94) & 0.91$^{}$ (0.88, 0.95) & 0.91$^{}$ (0.88, 0.95) & 0.92$^{}$ (0.88, 0.95) \\ 
  Primary ed & 0.76$^{}$ (0.72, 0.80) & 0.76$^{}$ (0.72, 0.80) & 0.78$^{}$ (0.74, 0.82) & 0.78$^{}$ (0.74, 0.82) \\ 
  Moderate compromise & 1.07$^{}$ (1.02, 1.13) & \textbf{1.08$^{}$ (1.03, 1.14)} & 1.08$^{}$ (1.02, 1.13) & \textbf{1.08$^{}$ (1.03, 1.14)} \\ 
  Severe compromise & 1.33$^{}$ (1.27, 1.39) & \textbf{1.32$^{}$ (1.27, 1.38)} & 1.34$^{}$ (1.29, 1.40) & \textbf{1.33$^{}$ (1.28, 1.39)} \\ 
  Woman specific & 1.27$^{}$ (1.22, 1.32) & 1.29$^{}$ (1.24, 1.33) & 1.25$^{}$ (1.21, 1.30) & 1.27$^{}$ (1.23, 1.32) \\ 
  Employee & 0.89$^{}$ (0.86, 0.92) & 0.91$^{}$ (0.88, 0.94) & 0.89$^{}$ (0.86, 0.93) & 0.91$^{}$ (0.88, 0.94) \\ 
  Inactive & 0.92$^{}$ (0.89, 0.96) & 0.96$^{}$ (0.93, 1.00) & 0.93$^{}$ (0.89, 0.96) & 0.96$^{}$ (0.92, 1.00) \\ 
  Freq & 1.00$^{}$ (1.00, 1.01) & 1.01$^{}$ (1.00, 1.01) & 1.00$^{}$ (0.99, 1.01) & 1.00$^{}$ (1.00, 1.01) \\ 
  Age & 0.99$^{}$ (0.99, 0.99) & 0.99$^{}$ (0.99, 0.99) & 0.99$^{}$ (0.99, 0.99) & 0.99$^{}$ (0.99, 0.99) \\ 
  TD x Strata2 & 0.99$^{}$ (0.91, 1.08) & \textbf{1.01$^{}$ (0.93, 1.10)} & 1.00$^{}$ (0.92, 1.08) & \textbf{1.01$^{}$ (0.93, 1.09)} \\ 
  TD x Strata3 & 1.09$^{}$ (0.96, 1.23) & \textbf{1.12$^{}$ (0.98, 1.26)} & 1.05$^{}$ (0.91, 1.19) & \textbf{1.06$^{}$ (0.93, 1.20)} \\ 
 \hline \\[-1.8ex] 
\hline 
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 

##



```{r descriptives, echo=FALSE}
descriptivos <- rbind(round(summary(rfimp$edad_al_ing),1),round(summary(rfimp$edad_inicio),1))
rownames(descriptivos) = c("Edad","Edad de inicio")
kable(descriptivos,booktabs = T,format = "markdown")
```
## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
